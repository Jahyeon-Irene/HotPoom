<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pooms">

	<select id="selectPoomDetail" parameterType="int" resultType="Poom">
		SELECT p.no no, p.type type, p.title title, p.user_no userNo,u.profile_img hostImg, u.name hostName, p.species_no speciesNo, s.name speciesName, p.price price, p.check_in checkIn, p.check_out checkOut, p.pet_cnt petCnt, p.introduce introduce, p.amenity amenity, p.main_address mainAddress, p.sub_address subAddress, p.post_num postNum, p.transport transport, p.lat lat, p.lng lng, pt.img mainImg, tmp.avgScore, tmp.reviewCnt
		FROM pooms p, species s, photos pt, users u, (SELECT NVL(TRUNC(avg(r.score),1),0) avgScore, count(*) reviewCnt
													FROM reviews r, bookings b, pooms p, users u
													WHERE p.no = b.poom_no
													AND r.booking_no = b.no
													AND r.user_no = u.no
                                                    AND p.no = #{no}) tmp
		WHERE p.species_no = s.no
		AND p.user_no = u.no
		AND pt.content_no(+) = p.no
		AND pt.type(+) = 'M'
		AND p.no = #{no}
	</select>
	

</mapper>